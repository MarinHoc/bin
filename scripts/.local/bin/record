#!/bin/sh
#
# record - record an area of the screen

_() bspc config "$@"

DIR=~/medias/videos/records

mkdir -p "$DIR"

IFS=+x; set -- $(
    hacksaw                     \
        -ns "$(_ border_width)" \
        -c "$(_ focused_border_color)"
)

test $# -eq 0 && exit

w=$(($1 + $1 % 2))
h=$(($2 + $2 % 2))

cur=$(date +%F_%H-%M-%S)

ffmpeg               \
    -v 16            \
    -r 30            \
    -f x11grab       \
    -s "${w}x${h}"   \
    -i ":0.0+$3,$4"  \
    -preset slow     \
    -c:v h264        \
    -pix_fmt yuv420p \
    -crf 20          \
    "$DIR/$cur.mp4"
