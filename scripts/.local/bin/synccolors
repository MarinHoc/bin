#!/usr/bin/env bash
#
# sync colorschemes

# build a list of escape sequences
while read -r line; do
    [[ $line =~ ^[^!](.+):$'\t'*(#.{6}) ]] && {
        read -r key var <<< ${BASH_REMATCH[@]:1}

        case $key in
            *foreground)  : 10;;
            *background)  : 11;;
            *cursorColor) : 12;;
            *color*)
                [[ $key =~ ([0-9]+) ]] &&
                    : "4;${BASH_REMATCH[1]}"
                ;;
            *) continue
        esac

        sequences+=("$_;$var")
    }
done < <(xrdb -query)

# send to terminals
for term in /dev/pts/[0-9]*; {
    for sequence in "${sequences[@]}"; {
        printf '%b' "\e]$sequence\007" > "$term"
    }
}
