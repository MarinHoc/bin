#!/usr/bin/env bash
#
# chicken-search-updates - search for updates for chicken eggs

declare -A eggs

while read -r line; do
    [[ $line =~ ^(.*)' '.*' version: '(.*)$ ]] &&
        eggs[${BASH_REMATCH[1]}]=${BASH_REMATCH[2]}
done <<< $(chicken-status)

chicken-install -u > /dev/null

for egg in "${!eggs[@]}"; {
    IFS=: read -r _ tmp <<< $(chicken-install -list-versions "$egg")

    [[ $tmp =~ error ]] &&
        continue

    read -ra versions <<< $tmp

    max=$versions

    for cur in "${versions[@]:1}"; {
        IFS=.- read -ra fields_cur <<< ${cur//[^0-9.-]}
        IFS=.- read -ra fields_max <<< ${max//[^0-9.-]}

        for ((i = 0; i < "${#fields_cur[@]}"; ++i)) {
            field_cur=${fields_cur[i]}
            field_max=${fields_max[i]}

            field_cur=$((${field_cur#*0}))
            field_max=$((${field_max#*0}))

            ((field_cur > field_max)) &&
                max=$cur
        }
    }

    [[ ${eggs[$egg]} != "$max" ]] &&
        printf '%s -> %s\n' "$egg" "$max"
}

:
