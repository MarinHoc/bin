#!/usr/bin/env bash
#
# chicken-search-updates - search for updates for chicken eggs

declare -A eggs

while read -r line; do
    [[ $line =~ ^(.*)' '.*' version: '(.*)$ ]] &&
        eggs[${BASH_REMATCH[1]}]=${BASH_REMATCH[2]}
done <<< $(chicken-status)

chicken-install -u > /dev/null

for egg in "${!eggs[@]}"; {
    IFS=: read -r _ tmp <<< $(chicken-install -list-versions "$egg")

    [[ $tmp =~ error ]] &&
        continue

    read -ra versions <<< $tmp

    max=$versions

    for version in "${versions[@]:1}"; {
        [[ $version > "$max" ]] &&
            max=$version
    }

    [[ ${eggs[$egg]} != "$max" ]] &&
        printf '%s -> %s\n' "$egg" "$max"
}

:
