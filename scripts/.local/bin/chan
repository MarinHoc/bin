#!/usr/bin/env bash
#
# chan - download medias from 4chan threads

(($#)) || {
    echo "usage : ${0##*/} [thread]" >&2
    exit 1
}

while read -rd \< line; do
    [[ $line =~ 'a href="'('//is2.4chan.org/'[^\"]+) ]] &&
        array+=("https:${BASH_REMATCH[1]}")
done < <(curl -s "$1")

for file in "${array[@]}"; {
    wget "$file" &> /dev/null || {
        echo "error : downloading '${file##*/}' failed" >&2
        exit 1
    }

    echo "downloaded '${file##*/}'"
}
